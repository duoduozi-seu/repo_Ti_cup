# ğŸ¯ 2025 TIæ¯å…¨å›½å¤§å­¦ç”Ÿç”µå­è®¾è®¡ç«èµ› Eé¢˜ï¼šç®€æ˜“è‡ªè¡Œç„å‡†è£…ç½® ğŸš€

## ğŸŒŸ é¡¹ç›®æ¦‚è¿°
æœ¬é¡¹ç›®å®ç°äº†ä¸€å¥—é«˜åº¦é›†æˆçš„æ™ºèƒ½ç„å‡†ç³»ç»Ÿï¼Œç»“åˆäº†ï¼š
- ğŸ§­ **ç²¾å‡†è¿åŠ¨æ§åˆ¶**ï¼ˆPIDåŒç”µæœºæ§åˆ¶ï¼‰
- ğŸ¤– **AIè§†è§‰è¯†åˆ«**ï¼ˆMaxicam Proç›®æ ‡æ£€æµ‹ï¼‰
- ğŸ¯ **å®æ—¶åŠ¨æ€ç„å‡†**ï¼ˆä¸‰ç»´ç©ºé—´åæ ‡è½¬æ¢ï¼‰
- ğŸ“Š **å¤šæ¨¡æ€äº¤äº’ç³»ç»Ÿ**ï¼ˆOLED+çŸ©é˜µé”®ç›˜ï¼‰

ç³»ç»Ÿåœ¨å¤æ‚ç¯å¢ƒä¸‹è¡¨ç°å‡ºä¼˜å¼‚çš„ç¨³å®šæ€§å’Œç²¾ç¡®æ€§ï¼ŒæˆåŠŸè§£å†³äº†"ç§»åŠ¨å¹³å°ä¸Šçš„å®æ—¶ç„å‡†"è¿™ä¸€æ ¸å¿ƒæŒ‘æˆ˜ã€‚

---

## ğŸ§© ç³»ç»Ÿæ¶æ„
```
+-----------------+     +----------------+     +---------------+
|  è§†è§‰å¤„ç†æ¨¡å—     |<--->| ä¸»æ§åˆ¶å™¨(MSPM0) |<--->| äº‘å°æ§åˆ¶ç³»ç»Ÿ    |
| (Maxicam Pro)   |     |                |     | (ZDT42æ­¥è¿›)   |
+-----------------+     +-------+--------+     +---------------+
            â†‘                   |                    â†‘
            |                   |                    |
            |                   â†“                    |
      +------------+     +---------------+     +---------------+
      | å·¡çº¿æ¨¡å—    |     | ç”µæœºæ§åˆ¶ç³»ç»Ÿ    |     |   æ¿€å…‰å‘å°„è£…ç½®  |
      |  K230      |     | (PID+ç¼–ç å™¨)   |     |               |
      +------------+     +---------------+     +---------------+
```

---

## ğŸ’¡ æ ¸å¿ƒåˆ›æ–°ç‚¹

### 1. åŠ¨æ€PIDè°ƒæ•´ç³»ç»Ÿ ğŸ”„
```c
void adj_perf4_pid() {
  KP_p4 = InputFloat(8, 2, 0); 
  KD_p4 = InputFloat(8, 2, 0);
}
```

### 2. ä¸‰ç»´ç©ºé—´åæ ‡æ˜ å°„ ğŸ—ºï¸
```c
void calculate_angles_for_perf4(float x, float y, float height, int car_direction, 
                       float target_x, float target_y, float target_height,
                       float *yaw, float *pitch) {
  // ç©ºé—´å‡ ä½•è§£ç®—æ ¸å¿ƒç®—æ³•
}
```

### 3. å¤åˆä»»åŠ¡å¤„ç†å™¨ âš™ï¸
```c
void Perform4() {
  while(car_stage != 's'){
    go_on_line(0.25);      // å·¡çº¿æ§åˆ¶
    update_motor_speed();  // ç”µæœºæ›´æ–°
    if(perf_4_flag) {      // æ‰“é¶æ¡ä»¶æ£€æµ‹
      calculate_target();  // ç›®æ ‡è§£ç®—
    }
  }
}
```

---

## ğŸ§  æ™ºèƒ½æ ¸å¿ƒæ¨¡å—

### 1. è¿åŠ¨æ§åˆ¶ç³»ç»Ÿ (`motor.c`)
```c
// è‡ªé€‚åº”å·¡çº¿ç®—æ³•
int go_on_line(float speed_m_per_s) {
  float current_error = line_error; // è§†è§‰è¯¯å·®è¾“å…¥
  float p_term = KP * current_error; 
  float d_term = KD * (current_error - last_error);
  // ...æ™ºèƒ½é€Ÿåº¦åˆ†é…ç®—æ³•...
}

// ç²¾ç¡®è½¬å‘æ§åˆ¶
void turn_pid(float base_speed, float target_angle, float threshold, float Kp) {
  while (fabsf(calculate_yaw_error(target_angle, yaw)) >= threshold) {
    // å®æ—¶è°ƒæ•´è½¬å‘å‚æ•°
  }
}
```

### 2. äº‘å°ç„å‡†ç³»ç»Ÿ (`PTZ_controller.c`)
```c
// ä¸–ç•Œåæ ‡ç³»è½¬æ¢
void calculate_angles(float x, float y, float* theta_x, float* theta_y) {
  *theta_x = atan2f(x, dist_to_canvas) * (180.0f / M_PI);
  float effective_dist = sqrtf(x*x + dist_to_canvas*dist_to_canvas);
  *theta_y = atan2f(y - pen_height, effective_dist) * (180.0f / M_PI);
}

// äº¤äº’å¼äº‘å°æ§åˆ¶
void contrl_ptz() {
  int x = (int)InputFloat(5, 0, 0); // Xè½´è§’åº¦
  int y = (int)InputFloat(5, 0, 0); // Yè½´è§’åº¦
  set_xy_offsets(x,y); // è®¾ç½®äº‘å°ä½ç½®
}
```

### 3. è§†è§‰é€šä¿¡ç³»ç»Ÿ (`uart_handler.c`)
```c
// é²æ£’æ€§é€šä¿¡åè®®
void extract_template(uint8_t *data, uint8_t size) {
  if(data[0]=='<' && data[7]=='>') { // å¸§æ ¡éªŒ
    // æ•°æ®æå–ä¸è½¬æ¢
    convert_to_float(nums); // è§†è§‰è¯¯å·®å€¼è½¬æ¢
  }
}

// DMAåŒç¼“å†²ä¼ è¾“
void uart_init(void) {
  DL_UART_Main_enableDMAReceiveEvent(UART_K230_INST, DL_UART_DMA_INTERRUPT_RX);
  // ...åŒç¼“å†²é…ç½®...
}
```

### 4. å¤šä»»åŠ¡è°ƒåº¦ç³»ç»Ÿ (`main.c`)
```c
while(1) {
  char key = KEY_SCAN(); // çŸ©é˜µé”®æ‰«æ
  switch (key) {
    case 1: Perform1(); break; // åŸºç¡€å·¡çº¿
    case 4: Perform4(); break; // å·¡çº¿+æ‰“é¶
    case 7: contrl_ptz(); break; // æ‰‹åŠ¨äº‘å°
    case 11: adj_line_pid(); break; // PIDè°ƒæ•´
  }
}
```

---

## ğŸ”­ Maxicam Proè§†è§‰æ¨¡å— (multy_edge.py)

### ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

#### 1. çŸ©å½¢ç›®æ ‡æ£€æµ‹ä¸é€è§†å˜æ¢
```python
def process_quadrilateral_detection(img, serial, frame_counter):
  # å›¾åƒé¢„å¤„ç†ï¼šç•¸å˜æ ¡æ­£ã€ROIåŒºåŸŸå¤„ç†
  # è¾¹ç¼˜æ£€æµ‹ä¸è½®å»“æŸ¥æ‰¾
  # è®¡ç®—é€è§†å˜æ¢çŸ©é˜µ
  # è¿”å›çŸ©å½¢è§’ç‚¹åæ ‡å’Œä¸­å¿ƒä½ç½®
```

#### 2. æ¿€å…‰ç‚¹æ£€æµ‹
```python
def detect_laser_point(img):
  # LABé¢œè‰²ç©ºé—´è½¬æ¢
  # åŒé˜ˆå€¼æ£€æµ‹ï¼ˆå†…åœˆå’Œå¤–åœˆï¼‰
  # å½¢æ€å­¦å¢å¼ºå¤„ç†
  # è¿”å›æ¿€å…‰ç‚¹ä¸­å¿ƒåæ ‡
```

#### 3. äº‘å°æ§åˆ¶æŒ‡ä»¤ç”Ÿæˆ
```python
def set_xy_angles(uart, x_angle, y_angle):
  # è‡ªé€‚åº”é€Ÿåº¦æ§åˆ¶ï¼ˆå¤§è§’åº¦å˜åŒ–ç”¨é«˜é€Ÿï¼Œå°è§’åº¦å¾®è°ƒç”¨ä½é€Ÿï¼‰
  # ç”Ÿæˆæ­¥è¿›ç”µæœºæ§åˆ¶å¸§ï¼ˆ29å­—èŠ‚å®Œæ•´å¸§ï¼‰
  # é€šè¿‡ä¸²å£å‘é€æŒ‡ä»¤å¹¶æ›´æ–°å½“å‰è§’åº¦
```

#### 4. ç‰©ç†å»ºæ¨¡ä¸è§’åº¦è§£ç®—ï¼ˆæ ¸å¿ƒåˆ›æ–°ï¼‰
```python
def calculate_angles_for_perf4(total_distance):
  """
  ğŸ“ åŸºäºåº•ç›˜é‡Œç¨‹è®¡æ•°æ®çš„ç‰©ç†å»ºæ¨¡è®¡ç®—
  
  å‚æ•°:
    total_distance: åº•ç›˜ç´¯è®¡è¡Œé©¶è·ç¦»(cm)
  
  è¿”å›:
    yaw: äº‘å°æ°´å¹³è½¬è§’(0-720+åº¦)
    pitch: äº‘å°ä¿¯ä»°è§’(åº¦)
  """
  
  # 1. æ ¹æ®æ€»è·¯ç¨‹è®¡ç®—è½¦è¾†ä½ç½®
  n, x, y = get_position_from_distance(total_distance)
  
  # 2. åæ ‡ç³»è½¬æ¢æ¨¡å‹
  # ä¸–ç•Œåæ ‡ç³» â†’ è½¦è¾†åæ ‡ç³» â†’ äº‘å°åæ ‡ç³»
  dx = target_x - x
  dy = target_y - y
  dz = target_height - height
  
  # 3. æ°´å¹³è·ç¦»è®¡ç®—ï¼ˆå¿½ç•¥é«˜åº¦ï¼‰
  horizontal_distance = math.sqrt(dx**2 + dy**2)
  
  # 4. ä¿¯ä»°è§’è®¡ç®—
  pitch = math.degrees(math.atan2(dz, horizontal_distance))
  
  # 5. ç»å¯¹æ°´å¹³è§’åº¦è®¡ç®—
  absolute_yaw = 90 - math.degrees(math.atan2(dy, dx))
  
  # 6. è½¦å¤´æœå‘è¡¥å¿
  # æ ¹æ®è½¦è¾†æ‰€åœ¨è·‘é“ä½ç½®ç¡®å®šè½¦å¤´æ–¹å‘
  if on_side1: car_heading = -180  # è½¦å¤´å‘ä¸‹
  elif on_side2: car_heading = -270 # è½¦å¤´å‘å³
  # ...
  
  # 7. ç›¸å¯¹è§’åº¦è®¡ç®—
  relative_yaw = absolute_yaw - car_heading
  return relative_yaw, pitch
```

### ğŸ”„ é‡Œç¨‹è®¡æ•°æ®èåˆæµç¨‹
```mermaid
graph LR
  A[åº•ç›˜é‡Œç¨‹è®¡æ•°æ®] --> B(æ€»è·¯ç¨‹è¾“å…¥)
  B --> C{ä½ç½®è®¡ç®—}
  C -->|æ­£æ–¹å½¢è·‘é“| D[åœˆæ•°n, x, yåæ ‡]
  D --> E[äº‘å°-é¶ç‚¹å‘é‡è§£ç®—]
  E --> F[æ°´å¹³è·ç¦»è®¡ç®—]
  F --> G[ä¿¯ä»°è§’pitchè®¡ç®—]
  G --> H[ç»å¯¹æ°´å¹³è§’è®¡ç®—]
  H --> I[è½¦å¤´æœå‘è¡¥å¿]
  I --> J[è¾“å‡ºyaw/pitch]
```

---

## ğŸš— K230å·¡çº¿æ¨¡å— (weapon_car.py)

### ğŸ” æ ¸å¿ƒåŠŸèƒ½

#### 1. å¤šåŒºåŸŸå·¡çº¿æ£€æµ‹
```python
def find_blobs_in_rois(img):
  # åˆ’åˆ†5ä¸ªå‚ç›´ROIåŒºåŸŸ
  # è‰²å—è¿‡æ»¤ï¼ˆé¢ç§¯800-15000åƒç´ ï¼‰
  # åŒºåŸŸæƒé‡åˆ†é…ï¼ˆä¸‹æ–¹åŒºåŸŸæƒé‡æ›´é«˜ï¼‰
```

#### 2. å³è½¬ä¼˜å…ˆå†³ç­–
```python
def detect_road_choose_right(roi_blobs_result, img):
  # é€‰æ‹©æ¯ä¸ªåŒºåŸŸæœ€å³ä¾§çš„è‰²å—
  # åŠ æƒå¹³å‡è®¡ç®—è½¬å‘åå·®
  # è¾“å‡ºæ ¼å¼åŒ–æ§åˆ¶æŒ‡ä»¤ï¼š<Â±XX.XX>
```

#### 3. ç‰¹æ®Šåœºæ™¯è¯†åˆ«
```python
def detect_left_turn(roi_blobs_result):
  # æ¡ä»¶1ï¼šROI1æ— æœ‰æ•ˆè‰²å—
  # æ¡ä»¶2ï¼šROI2/ROI3å‡ºç°å¤§é¢ç§¯è‰²å—
  # è§¦å‘å·¦è½¬æ ‡å¿—ï¼š<+99.99>
```

---

## ğŸ› ï¸ ç¡¬ä»¶é…ç½®
| æ¨¡å—         | å‹å·/è§„æ ¼                     | åŠŸèƒ½ç‰¹ç‚¹                     |
|--------------|-------------------------------|-----------------------------|
| ä¸»æ§åˆ¶å™¨     | TI MSPM0G3507                 | 80MHz Cortex-M0+æ ¸å¿ƒ       |
| é©±åŠ¨ç”µæœº     | MG520Xç›´æµå‡é€Ÿç”µæœº         | 6V/300RPMï¼Œé›†æˆå…‰ç”µç¼–ç å™¨   |
| äº‘å°ç”µæœº     | ZDT42æ­¥è¿›ç”µæœº                 | 1.8Â°æ­¥è¿›è§’ï¼Œé«˜ç²¾åº¦é—­ç¯æ§åˆ¶  |
| è§†è§‰æ¨¡å—     | Maxicam Pro AIè§†è§‰æ¨¡ç»„        | æ”¯æŒYOLOv5ç›®æ ‡æ£€æµ‹          |
| å·¡çº¿æ¨¡å—     | K230è§†è§‰å¤„ç†å™¨                | 5åŒºåŸŸROIæ£€æµ‹ï¼Œ640Ã—480è¾“å…¥   |
| å§¿æ€ä¼ æ„Ÿå™¨  | LSM6DSV16X 6è½´IMU             | Â±2000dpsï¼Œä½å™ªå£°            |
| æ˜¾ç¤ºæ¨¡å—     | SSD1306 0.96å¯¸OLED            | 128Ã—64åˆ†è¾¨ç‡ï¼ŒIÂ²Cæ¥å£       |
| è¾“å…¥è®¾å¤‡     | 4Ã—4çŸ©é˜µé”®ç›˜                   | 16é”®å¤šåŠŸèƒ½æ§åˆ¶              |

---

## ğŸ’» å¼€å‘ç¯å¢ƒ
1. **ç¼–è¯‘ç¯å¢ƒ**ï¼š  
   TI Code Composer Studio  
   - é›†æˆç¼–è¯‘+è°ƒè¯•+çƒ§å½•ä¸€ä½“åŒ–ç¯å¢ƒ
   - å®Œæ•´MSPM0èŠ¯ç‰‡æ”¯æŒåŒ…
   - å®æ—¶å˜é‡ç›‘æ§ä¸åˆ†æå·¥å…·

2. **çƒ§å½•å·¥å…·**ï¼š  
   TI XDS110 Debug Probe  
   - é€šè¿‡USBç›´æ¥çƒ§å½•å’Œè°ƒè¯•
   - æ”¯æŒå®æ—¶å˜é‡ç›‘æ§
   - 4çº¿JTAGæ¥å£

3. **ä¾èµ–åº“**ï¼š
   ```bash
   DriverLib - MSPM0å¤–è®¾é©±åŠ¨åº“
   grlib - å›¾å½¢æ˜¾ç¤ºåº“
   math.h - æ•°å­¦è¿ç®—åº“
   OpenCV - è®¡ç®—æœºè§†è§‰åº“
   ```

---

## ğŸ“‹ ä½¿ç”¨æŒ‡å—
```mermaid
graph TD
  A[ç³»ç»Ÿä¸Šç”µ] --> B{æ¨¡å¼é€‰æ‹©}
  B -->|æŒ‰é”®1| C[åŸºç¡€å·¡çº¿]
  B -->|æŒ‰é”®4| D[å·¡çº¿+æ‰“é¶]
  B -->|æŒ‰é”®7| E[æ‰‹åŠ¨äº‘å°æ§åˆ¶]
  C --> F[K230å·¡çº¿æ¨¡å—æ¿€æ´»]
  D --> G[Maxicamç›®æ ‡è¿½è¸ª]
  E --> H[çŸ©é˜µé”®ç›˜è¾“å…¥åæ ‡]
  G --> I[æ¥æ”¶åº•ç›˜é‡Œç¨‹è®¡æ•°æ®]
  I --> J[ç‰©ç†å»ºæ¨¡è®¡ç®—yaw/pitch]
  J --> K[äº‘å°ç²¾å‡†å®šä½]
```


---
## ğŸ“œ ç‰ˆæƒå£°æ˜
Â© 2025 ç”Ÿä¸ºåˆºçŒ¬é˜Ÿï¼ˆä¸œå—å¤§å­¦ï¼‰ - ä¿ç•™æ‰€æœ‰æƒåˆ©  
**ä»£ç æˆæƒ**ï¼šMIT License  
**TIé©±åŠ¨åº“ç‰ˆæƒ**ï¼šå½’Texas Instruments Incorporatedæ‰€æœ‰
